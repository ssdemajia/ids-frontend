<template>
  <div :class="className" :style="{height:height,width:width}"></div>
</template>
<script>
import _ from 'lodash'

import echarts from "echarts";
import { getDeviceInfo } from "@/api/situation";
require("echarts/map/js/world.js");
require("echarts/map/js/china.js");
import { debounce } from "@/utils";
import { getSystemInfoByIp } from '@/api/situation'


export default {
  props: {
    className: {
      type: String,
      default: "chart"
    },
    autoResize: {
      type: Boolean,
      default: true
    },
    height: String
  },
  data() {
    return {
      width: "100%",
      chart: null,
      chartData: {},
      icon: {
        's7':"M741.06368 733.310464c8.075264-29.262438 20.615373-40.632422 14.64105-162.810061C966.089728 361.789952 967.93897 72.37847 967.855002 54.693683c0.279347-0.279347 0.418509-0.419533 0.418509-0.419533s-0.17705-0.00512-0.428749-0.00512c0-0.251699 0-0.428749 0-0.428749s-0.139162 0.14633-0.418509 0.425677c-17.695744-0.083866-307.10784 1.760051-515.833958 212.142592-122.181632-5.984256-133.55305 6.563533-162.815693 14.644531C235.35063 295.798886 103.552614 436.975309 90.630758 486.076621c-12.921856 49.105408 39.634227 56.859034 58.579558 58.581197 18.953421 1.724314 121.471386-9.475789 130.09111 4.309094 0 0 16.367411 11.200102 17.226035 41.346662 0.850432 29.796659 15.173222 71.354163 37.123994 97.267302-0.028672 0.027648-0.05632 0.054272-0.083866 0.074752 0.158618 0.13097 0.316211 0.261939 0.474829 0.390861 0.129946 0.149402 0.261939 0.319283 0.393011 0.468685 0.019456-0.019456 0.04608-0.049152 0.075776-0.075674 25.918362 21.961216 67.477504 36.272128 97.269248 37.122458 30.149837 0.859546 41.354547 17.234534 41.354547 17.234534 13.779354 8.608051 2.583962 111.122842 4.302131 130.075546 1.727386 18.95168 9.477222 71.498445 58.579558 58.576077C585.12896 918.526771 726.311117 786.734182 741.06368 733.310464zM595.893555 426.206003c-39.961702-39.965184-39.961702-104.75991 0-144.720077 39.970918-39.96928 104.768307-39.96928 144.730112 0 39.970918 39.960064 39.970918 104.75479 0 144.720077C700.661862 466.171187 635.864474 466.171187 595.893555 426.206003zM358.53312 769.516032c-31.923302-4.573184-54.890394-18.410291-71.41847-35.402342-16.984474-16.526438-30.830387-39.495475-35.405824-71.420621-4.649062-28.082586-20.856832-41.167565-38.76649-38.763827-17.906586 2.40681-77.046886 66.714419-80.857805 89.475891-3.80887 22.752154 29.271859 12.081152 46.424166 27.654861 17.151283 15.590093-2.139853 61.93664-14.733107 86.845952-6.441984 12.735078-10.289766 26.42176-4.22953 33.76087 7.346586 6.070272 21.03593 2.222592 33.769472-4.220109 24.912384-12.585677 71.258829-31.872922 86.842368-14.731469 15.583539 17.160806 4.911002 50.229965 27.674419 46.419251 22.754099-3.807744 87.065395-62.946611 89.466163-80.85248C399.70857 790.374093 386.627072 774.166938 358.53312 769.516032z",
        "omron": "M665.3952 995.5328a65.9456 65.9456 0 0 1-48.3328-20.48c-15.9744-17.408-66.3552-62.8736-107.7248-62.8736s-92.3648 45.6704-107.1104 61.44a66.1504 66.1504 0 0 1-48.128 20.48 61.44 61.44 0 0 1-24.576-4.9152h-1.2288l-125.7472-71.0656h-1.2288a61.44 61.44 0 0 1-20.48-72.9088 150.3232 150.3232 0 0 0 11.6736-50.9952 133.3248 133.3248 0 0 0-133.12-133.12h-5.12c-20.48 0-38.0928-18.6368-43.6224-47.5136A647.9872 647.9872 0 0 1 0 512a649.0112 649.0112 0 0 1 10.6496-100.352c5.5296-29.2864 22.9376-48.128 44.4416-47.5136h4.5056a133.3248 133.3248 0 0 0 133.12-133.12 150.1184 150.1184 0 0 0-11.6736-50.9952 60.2112 60.2112 0 0 1 20.48-72.704h1.2288l132.5056-72.9088h1.4336a61.44 61.44 0 0 1 24.3712-4.7104 67.1744 67.1744 0 0 1 48.128 20.48c15.7696 16.384 65.3312 59.1872 105.472 59.1872s89.088-40.96 104.6528-57.9584a67.3792 67.3792 0 0 1 47.7184-19.456 61.44 61.44 0 0 1 24.7808 4.9152h1.4336l128 69.8368h1.2288a60.2112 60.2112 0 0 1 20.48 72.9088 149.9136 149.9136 0 0 0-11.6736 50.9952 133.3248 133.3248 0 0 0 133.12 133.12h4.5056c20.48 0 38.912 18.2272 44.4416 47.5136A647.5776 647.5776 0 0 1 1024 512a647.3728 647.3728 0 0 1-10.6496 100.352c-5.5296 29.2864-23.1424 47.9232-44.4416 47.5136h-4.5056a133.3248 133.3248 0 0 0-133.12 133.12 150.528 150.528 0 0 0 11.6736 50.9952 60.2112 60.2112 0 0 1-20.48 72.704h-1.2288l-130.2528 71.8848h-1.4336a61.44 61.44 0 0 1-24.1664 4.9152z m-3.8912-61.44a8.192 8.192 0 0 0 3.8912 1.024l121.6512-67.1744a206.6432 206.6432 0 0 1-16.384-74.5472 193.7408 193.7408 0 0 1 184.32-193.1264 586.752 586.752 0 0 0 8.6016-88.2688 586.9568 586.9568 0 0 0-9.4208-87.8592 193.7408 193.7408 0 0 1-184.32-193.1264 206.6432 206.6432 0 0 1 16.384-74.5472L667.648 90.3168a9.4208 9.4208 0 0 0-4.5056 1.2288 338.5344 338.5344 0 0 1-44.2368 37.2736 184.32 184.32 0 0 1-103.6288 39.1168A184.32 184.32 0 0 1 409.6 128a338.944 338.944 0 0 1-43.8272-37.888 9.6256 9.6256 0 0 0-4.7104-1.2288l-124.3136 67.9936a206.848 206.848 0 0 1 16.384 74.3424 193.7408 193.7408 0 0 1-184.32 193.1264A584.704 584.704 0 0 0 60.2112 512a585.5232 585.5232 0 0 0 9.4208 87.8592 193.7408 193.7408 0 0 1 184.32 193.1264 206.6432 206.6432 0 0 1-16.384 74.5472l117.3504 65.536a8.192 8.192 0 0 0 4.096 0 343.6544 343.6544 0 0 1 45.056-39.3216 184.32 184.32 0 0 1 106.2912-40.96 184.32 184.32 0 0 1 107.1104 42.3936 344.064 344.064 0 0 1 45.056 40.96z m0 0M509.7472 688.9472A177.3568 177.3568 0 1 1 687.104 512a177.5616 177.5616 0 0 1-177.3568 177.3568z m0-294.2976A116.9408 116.9408 0 1 0 626.688 512a117.1456 117.1456 0 0 0-116.9408-116.9408z m0 0",
        "modbus": "M844.8 486.9l-0.3-0.8-0.8-2.5-1.1-2.2-1.6-1.9-1.9-1.6-2.2-1.1-2.5-0.8-0.8-0.3c-0.8 0-6.3-5.5-11.7-12l-60.1-70.2c-5.7-6.6-14.7-6.6-20.5 0l-7.1 8.5c-5.7 6.6-14.7 17.2-20.5 23.8l-32.5 37.9c-5.7 6.6-14.7 6.6-20.5 0l-60.1-70.2c-5.5-6.6-14.7-6.6-20.5 0L520 463.7c-5.7 6.6-14.7 6.6-20.5 0l-17.2-20.2c-5.7-6.6-14.7-17.2-20.5-23.7l-22.4-26.2c-5.7-6.6-14.7-6.6-20.5 0l-60.1 70.2c-5.5 6.6-14.7 6.6-20.5 0l-60.1-70.2c-5.7-6.6-14.7-6.6-20.5 0l-60.1 70.2c-5.7 6.6-10.9 12-12 12l-0.8 0.3-2.5 0.8-2.2 1.1-1.9 1.6-1.6 1.9-1.1 2.2-0.8 2.5-0.3 0.8v417.7l0.3 0.8 0.8 2.5 1.1 2.2 1.6 1.9 1.9 1.6 2.2 1.1 2.5 0.8 0.8 0.3h646.7l0.8-0.3 2.5-0.8 2.2-1.1 1.9-1.6 1.6-1.9 1.1-2.2 0.8-2.5 0.3-0.8V504.3c1.3-8.7 1.3-16.3 1.3-17.4zM312.2 752.5h-55.4v-55.7h55.7v55.7h-0.3z m0-77.3h-55.4v-55.7h55.7v55.7h-0.3z m0-77.2h-55.4v-55.7h55.7V598h-0.3z m77.2 154.5H334v-55.7h55.7v55.7h-0.3z m0-77.3H334v-55.7h55.7v55.7h-0.3z m0-77.2H334v-55.7h55.7V598h-0.3z m77.3 154.5H411v-55.7h55.7v55.7z m0-77.3H411v-55.7h55.7v55.7z m0-77.2H411v-55.7h55.7V598z m77.5 154.5h-55.7v-55.7h55.7v55.7z m0-77.3h-55.7v-55.7h55.7v55.7z m0-77.2h-55.7v-55.7h55.7V598z m77.3 154.5h-55.7v-55.7h55.7v55.7z m0-77.3h-55.7v-55.7h55.7v55.7z m0-77.2h-55.7v-55.7h55.7V598z m0 0M581.1 362.7c5.7-6.6 14.7-6.6 20.5 0l60.1 70.2c5.7 6.6 14.7 6.6 20.5 0l32.5-37.9c5.7-6.6 8.5-18.8 6.3-27 0 0-40.7-163.5-45.6-259.6 0-6.3-3.8-11.5-8.7-11.5h-131c-4.6 0-8.5 5.2-8.5 11.5-5.2 102.1-50 277.3-50 277.3-2.2 8.5 0.8 20.5 6.3 27l17.2 20.2c5.7 6.6 14.7 6.6 20.5 0l59.9-70.2z m0 0",
        "bacnet": "M124.8 1020c-4 0-8-1.6-11.2-4.8L8.8 910.4c-4.8-4.8-6.4-12-3.2-18.4l72.8-144.8c1.6-3.2 4-5.6 8-7.2l147.2-66.4 124.8-124.8c6.4-6.4 16-6.4 22.4 0l94.4 94.4c3.2 3.2 4.8 7.2 4.8 11.2s-1.6 8-4.8 11.2L350.4 790.4l-66.4 147.2c-1.6 3.2-4 6.4-7.2 8l-144.8 72.8c-2.4 0.8-4.8 1.6-7.2 1.6zM39.2 896l88 88 129.6-64.8 65.6-144.8c0.8-1.6 1.6-3.2 3.2-4.8l116-116-72-72-116 116.8c-1.6 1.6-3.2 2.4-4.8 3.2L104 767.2 39.2 896zM599.2 781.6c-19.2 0-37.6-7.2-51.2-21.6L263.2 476c-28-28-28-74.4 0-103.2l2.4-2.4c13.6-13.6 32-21.6 51.2-21.6 19.2 0 37.6 7.2 51.2 21.6L652.8 656c28 28 28 74.4 0 103.2l-2.4 2.4c-12.8 12.8-31.2 20-51.2 20z m-282.4-400c-11.2 0-20.8 4-28.8 12l-2.4 2.4c-16 16-16 41.6 0 57.6l284.8 284.8c8 8 17.6 12 28.8 12s20.8-4 28.8-12l2.4-2.4c16-16 16-41.6 0-57.6L345.6 393.6c-8-7.2-17.6-12-28.8-12zM626.4 667.2c-4 0-8-1.6-11.2-4.8L360.8 409.6c-4.8-4.8-6.4-12.8-2.4-19.2 8.8-16.8 23.2-39.2 38.4-63.2 17.6-27.2 35.2-56 48-80 0.8-1.6 1.6-2.4 2.4-4L650.4 40.8c24-24 55.2-36.8 88.8-36.8 21.6 0 43.2 5.6 61.6 16 84 47.2 156 119.2 203.2 203.2 27.2 48.8 19.2 111.2-20.8 150.4L780.8 576c-0.8 0.8-1.6 1.6-3.2 2.4L634.4 665.6c-2.4 1.6-5.6 1.6-8 1.6zM392 395.2l236 236L760 552l200.8-200.8c29.6-29.6 36-76 15.2-112C932 160 864 92 784.8 48c-14.4-8-30.4-12-46.4-12-24.8 0-48.8 9.6-66.4 27.2L472 264c-13.6 24.8-31.2 52.8-48 80-12 18.4-23.2 36.8-32 51.2zM699.2 488.8c-13.6 0-25.6-5.6-35.2-14.4l-1.6-2.4c-19.2-19.2-19.2-51.2 0-70.4l146.4-146.4c9.6-9.6 21.6-14.4 35.2-14.4s25.6 4.8 35.2 14.4l1.6 1.6c19.2 19.2 19.2 51.2 0 70.4L734.4 473.6c-9.6 9.6-21.6 15.2-35.2 15.2zM844.8 256c-8.8 0-17.6 3.2-24 9.6L673.6 412.8c-13.6 13.6-13.6 34.4 0 48l1.6 1.6c6.4 6.4 15.2 9.6 24 9.6s17.6-3.2 24-9.6l146.4-146.4c13.6-13.6 13.6-34.4 0-48l-1.6-1.6c-5.6-6.4-14.4-10.4-23.2-10.4zM587.2 376c-13.6 0-25.6-5.6-35.2-14.4l-1.6-1.6c-9.6-9.6-14.4-21.6-14.4-35.2s4.8-25.6 14.4-35.2l146.4-146.4c9.6-9.6 21.6-14.4 35.2-14.4 13.6 0 25.6 4.8 35.2 14.4l1.6 1.6c19.2 19.2 19.2 51.2 0 70.4L622.4 361.6C612.8 371.2 600 376 587.2 376z m144.8-232c-8.8 0-17.6 3.2-24 9.6L561.6 300.8c-6.4 6.4-9.6 15.2-9.6 24s3.2 17.6 9.6 24l1.6 1.6c6.4 6.4 15.2 9.6 24 9.6s17.6-3.2 24-9.6l146.4-146.4c13.6-13.6 13.6-34.4 0-48l-1.6-1.6c-6.4-6.4-14.4-10.4-24-10.4z",
        "ethip": "M812.8 937.6c-33.6 0-64.8-12.8-88-36.8-48.8-48.8-48.8-128 0-176.8 23.2-23.2 55.2-36.8 88-36.8 33.6 0 64.8 12.8 88 36.8 48.8 48.8 48.8 128 0 176.8-23.2 24-54.4 36.8-88 36.8z m0-233.6c-28.8 0-56.8 11.2-76.8 32-42.4 42.4-42.4 111.2 0 154.4 20.8 20.8 48 32 76.8 32 28.8 0 56.8-11.2 76.8-32 42.4-42.4 42.4-111.2 0-154.4-20-20.8-48-32-76.8-32zM812.8 1020c-55.2 0-107.2-21.6-146.4-60.8-48-48-68.8-115.2-57.6-182.4L316 484c-21.6 6.4-44 9.6-67.2 9.6-65.6 0-126.4-25.6-172.8-72C24.8 370.4-0.8 300 5.6 228c0-4 1.6-7.2 4.8-10.4L36 192c6.4-6.4 16-6.4 22.4 0l121.6 121.6 87.2-48.8 48.8-87.2-122.4-120c-6.4-6.4-6.4-16 0-22.4l25.6-25.6c2.4-2.4 6.4-4 10.4-4.8 6.4-0.8 13.6-0.8 20-0.8 65.6 0 126.4 25.6 172.8 72 63.2 63.2 86.4 154.4 62.4 240l292.8 292.8c12-2.4 24-3.2 36-3.2 55.2 0 107.2 21.6 146.4 60.8 80.8 80.8 80.8 212 0 292.8-40 39.2-92 60.8-147.2 60.8zM320 449.6c4 0 8 1.6 11.2 4.8L636.8 760c4 4 5.6 9.6 4 14.4-12.8 58.4 4.8 119.2 47.2 161.6 32.8 32.8 76.8 51.2 124 51.2 46.4 0 90.4-18.4 124-51.2 68-68 68-179.2 0-248-32.8-32.8-76.8-51.2-124-51.2-12.8 0-25.6 1.6-37.6 4-5.6 0.8-11.2-0.8-14.4-4L454.4 331.2c-4-4-5.6-10.4-4-16 25.6-76.8 5.6-160-52-216.8-43.2-43.2-101.6-65.6-162.4-61.6l-9.6 9.6 118.4 118.4c4.8 4.8 6.4 12.8 2.4 19.2l-56.8 101.6c-1.6 2.4-3.2 4.8-6.4 6.4L184 348.8c-6.4 3.2-14.4 2.4-19.2-2.4L46.4 227.2l-9.6 9.6c-3.2 60.8 19.2 119.2 61.6 162.4 40 40 93.6 62.4 150.4 62.4 22.4 0 44.8-3.2 66.4-10.4 1.6-0.8 3.2-1.6 4.8-1.6zM707.2 672c-2.4 0-4-0.8-5.6-2.4L419.2 387.2c-3.2-3.2-3.2-8 0-11.2 3.2-3.2 8-3.2 11.2 0l282.4 282.4c3.2 3.2 3.2 8 0 11.2-1.6 1.6-3.2 2.4-5.6 2.4z",
        "iec104": "M512 1020C232 1020 4 792 4 512S232 4 512 4 1020 232 1020 512 792 1020 512 1020z m0-984C249.6 36 36 249.6 36 512s213.6 476 476 476 476-213.6 476-476S774.4 36 512 36zM512 912.8c-220.8 0-400.8-180-400.8-400.8S291.2 111.2 512 111.2s400.8 180 400.8 400.8-180 400.8-400.8 400.8z m0-785.6c-212 0-384.8 172.8-384.8 384.8s172.8 384.8 384.8 384.8 384.8-172.8 384.8-384.8S724 127.2 512 127.2zM512 568.8c-31.2 0-56.8-25.6-56.8-56.8s25.6-56.8 56.8-56.8 56.8 25.6 56.8 56.8-25.6 56.8-56.8 56.8z m0-97.6c-22.4 0-40.8 18.4-40.8 40.8s18.4 40.8 40.8 40.8 40.8-18.4 40.8-40.8-18.4-40.8-40.8-40.8zM512 841.6c-4.8 0-8-3.2-8-8v-34.4c0-4.8 3.2-8 8-8s8 3.2 8 8v34.4c0 4-3.2 8-8 8zM512 232.8c-4.8 0-8-3.2-8-8v-34.4c0-4.8 3.2-8 8-8s8 3.2 8 8v34.4c0 4-3.2 8-8 8zM833.6 520h-34.4c-4.8 0-8-3.2-8-8s3.2-8 8-8h34.4c4.8 0 8 3.2 8 8s-4 8-8 8zM224.8 520h-34.4c-4.8 0-8-3.2-8-8s3.2-8 8-8h34.4c4.8 0 8 3.2 8 8s-4 8-8 8zM739.2 747.2c-2.4 0-4-0.8-5.6-2.4l-24-24c-3.2-3.2-3.2-8 0-11.2s8-3.2 11.2 0l24 24c3.2 3.2 3.2 8 0 11.2-1.6 1.6-3.2 2.4-5.6 2.4zM308.8 316.8c-2.4 0-4-0.8-5.6-2.4l-24-24c-3.2-3.2-3.2-8 0-11.2s8-3.2 11.2 0l24 24c3.2 3.2 3.2 8 0 11.2-1.6 1.6-3.2 2.4-5.6 2.4zM715.2 316.8c-2.4 0-4-0.8-5.6-2.4-3.2-3.2-3.2-8 0-11.2l24-24c3.2-3.2 8-3.2 11.2 0s3.2 8 0 11.2l-24 24c-1.6 1.6-4 2.4-5.6 2.4zM284.8 747.2c-2.4 0-4-0.8-5.6-2.4-3.2-3.2-3.2-8 0-11.2l24-24c3.2-3.2 8-3.2 11.2 0s3.2 8 0 11.2l-24 24c-1.6 1.6-4 2.4-5.6 2.4zM512 471.2c-4.8 0-8-3.2-8-8V296.8c0-4.8 3.2-8 8-8s8 3.2 8 8v166.4c0 4-3.2 8-8 8zM463.2 520H348c-4.8 0-8-3.2-8-8s3.2-8 8-8h115.2c4.8 0 8 3.2 8 8s-4 8-8 8z",
        "redlion": "M645.632 1019.904h-281.6c-8.704 0-15.872-7.168-15.872-15.872V110.592c0-8.704 7.168-15.872 15.872-15.872h281.6c8.704 0 15.872 7.168 15.872 15.872v893.44c0 8.704-7.168 15.872-15.872 15.872z m-265.728-32.256h249.856V125.952h-249.856v861.696zM641.024 1011.712H368.64c-4.608 0-8.192-3.072-8.192-8.192v-155.136c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.072 8.192-7.68 8.192z m-264.192-15.872h256v-139.264h-256v139.264zM641.024 856.576H368.64c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.072 9.216-7.68 9.216z m-264.192-15.872h256v-139.776h-256v139.776zM641.024 545.28H368.64c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.072 9.216-7.68 9.216z m-264.192-15.872h256v-139.776h-256v139.776zM641.024 389.632H368.64c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.072 9.216-7.68 9.216z m-264.192-16.384h256V233.472h-256v139.776zM983.04 1019.904h-281.6c-8.704 0-15.872-7.168-15.872-15.872V110.592c0-8.704 7.168-15.872 15.872-15.872h281.6c8.704 0 15.872 7.168 15.872 15.872v893.44c0.512 8.704-6.656 15.872-15.872 15.872z m-265.216-32.256h249.856V125.952h-249.856v861.696zM978.432 1011.712H706.56c-4.608 0-8.192-3.072-8.192-8.192v-155.136c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.584 8.192-8.192 8.192z m-264.192-15.872h256v-139.264h-256v139.264zM978.432 856.576H706.56c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.584 9.216-8.192 9.216z m-264.192-15.872h256v-139.776h-256v139.776zM978.432 545.28H706.56c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.584 9.216-8.192 9.216z m-264.192-15.872h256v-139.776h-256v139.776zM978.432 389.632H706.56c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c0 5.12-3.584 9.216-8.192 9.216z m-264.192-16.384h256V233.472h-256v139.776zM305.664 1019.904h-281.6c-8.704 0-15.872-7.168-15.872-15.872V110.592c0-8.704 7.168-15.872 15.872-15.872h281.6c8.704 0 15.872 7.168 15.872 15.872v893.44c0 8.704-7.168 15.872-15.872 15.872z m-265.728-32.256h249.344V125.952h-249.344v861.696zM301.056 1011.712h-271.872c-4.608 0-8.192-3.072-8.192-8.192v-155.136c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c-0.512 5.12-3.584 8.192-8.192 8.192z m-264.192-15.872h256v-139.264h-256v139.264zM301.056 856.576h-271.872c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c-0.512 5.12-3.584 9.216-8.192 9.216z m-264.192-15.872h256v-139.776h-256v139.776zM301.056 545.28h-271.872c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c-0.512 5.12-3.584 9.216-8.192 9.216z m-264.192-15.872h256v-139.776h-256v139.776zM301.056 389.632h-271.872c-4.608 0-8.192-3.072-8.192-8.192v-156.16c0-4.608 3.072-8.192 8.192-8.192h271.872c4.608 0 8.192 3.072 8.192 8.192v155.136c-0.512 5.12-3.584 9.216-8.192 9.216z m-264.192-16.384h256V233.472h-256v139.776z",
        "clearscada": "M838.656 395.776V358.4h-89.6v35.328H371.2V358.4H274.944v45.056L230.912 414.72v38.4H0v124.416h230.912v47.616l44.032 15.872v47.104H371.2v-35.328h377.856v35.328h89.6v-37.376h210.944V395.776h-210.944zM230.912 551.936H25.6V478.72h205.312v73.216z m44.032 61.952l-18.432-6.656V434.688l18.432-4.608v183.808zM345.6 406.528v256.512h-45.056V384H345.6v22.528z m403.456 220.672H371.2V419.328h377.856v207.872z m64 35.328h-38.4V384h38.4V662.528z m210.944-37.376h-185.344V421.376h185.344v203.776zM915.456 481.28v-46.592h3.072v43.52h18.432v3.072h-21.504zM960.512 465.408c0 11.264-4.096 16.896-11.776 16.896-1.024 0-2.56 0-3.584-0.512v-3.072c1.536 0.512 2.56 0.512 3.584 0.512 3.072 0 5.12-1.024 6.656-3.584s2.048-5.632 2.048-10.752v-30.208h3.072v30.72zM991.744 482.304c-6.656 0-11.776-2.048-15.872-6.656s-5.632-10.24-5.632-16.896c0-7.168 2.048-13.312 6.144-17.92s9.216-6.656 16.384-6.656c6.144 0 11.264 2.048 15.36 6.656s5.632 9.728 5.632 16.896c0 7.68-2.048 13.824-6.144 17.92-1.024 1.536-2.56 2.56-4.096 3.584l11.264 8.704h-5.632l-8.704-7.168c-2.56 1.024-5.632 1.536-8.704 1.536z m0-45.568c-5.632 0-9.728 2.048-13.312 5.632s-5.12 9.216-5.12 15.36c0 6.656 1.536 11.264 5.12 15.36s7.68 5.632 13.312 5.632 10.24-2.048 13.824-5.632 5.12-9.216 5.12-15.872-1.536-11.776-5.12-15.36-8.192-5.12-13.824-5.12z",
        "snmp": "M469.4 448h85.3c11.8 0 21.3 9.6 21.3 21.3v85.3c0 11.8-9.6 21.3-21.3 21.3h-85.3c-11.8 0-21.3-9.6-21.3-21.3v-85.3c0-11.7 9.5-21.3 21.3-21.3zM320.1 320v384h384V320H320.1z m-21.4-64h426.7c23.6 0 42.7 19.1 42.7 42.7v426.7c0 23.6-19.1 42.7-42.7 42.7H298.7c-23.6 0-42.7-19.1-42.7-42.7V298.7c0.1-23.6 19.2-42.7 42.7-42.7zM192 149.3c-11.8 0-21.3 9.6-21.3 21.3v682.7c0 11.8 9.6 21.3 21.3 21.3h640c11.8 0 21.3-9.6 21.3-21.3V170.7c0-11.8-9.6-21.3-21.3-21.3h-640z m725.4 576.1v128c0 47.1-38.2 85.3-85.3 85.3H192.1c-47.1 0-85.3-38.2-85.3-85.3v-128H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h74.7v-64H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h74.7v-64H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h74.7v-64H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h74.7V170.7c0-47.1 38.2-85.3 85.3-85.3h640c47.1 0 85.3 38.2 85.3 85.3v106.7H992.1c17.7 0 32 14.3 32 32s-14.3 32-32 32h-74.7v64H992.1c17.7 0 32 14.3 32 32s-14.3 32-32 32h-74.7v64H992.1c17.7 0 32 14.3 32 32s-14.3 32-32 32h-74.7v64H992.1c17.7 0 32 14.3 32 32s-14.3 32-32 32h-74.7z",
        "dnp3": "M868.171497 739.301367C774.114164 768.687351 611.104861 643.556738 593.713385 588.286064 574.189056 526.270264 626.141091 515.729143 626.141091 515.729143 661.760652 505.115671 789.337693 547.024826 850.114839 490.614714 885.238412 457.970004 949.207319 468.091951 965.198243 506.376397 1001.432902 593.222563 953.848692 712.541086 868.171497 739.301367L868.171497 739.301367ZM630.970833 434.991891C567.463796 434.870602 573.745245 380.929806 573.745245 380.929806 574.905297 342.89112 653.176087 231.332682 619.67239 154.572288 600.267264 110.212971 629.41696 50.93033 669.867287 47.148167 761.535348 38.61888 857.417961 121.928639 855.745955 213.818759 853.903686 314.677551 687.549347 435.09828 630.970833 434.991891L630.970833 434.991891ZM503.056384 546.801408C469.795328 546.801408 442.858263 519.753877 442.858263 486.394224 442.858263 453.035636 469.795328 425.987039 503.056384 425.987039 536.332381 425.987039 563.313105 453.035636 563.313105 486.394224 563.313105 519.753877 536.332381 546.801408 503.056384 546.801408L503.056384 546.801408ZM432.615564 390.403835C397.713361 377.513621 318.503843 266.656293 237.008244 275.64093 189.884835 280.877447 143.922595 234.115845 152.950924 193.452516 173.382051 101.367706 280.223604 33.521734 364.857763 63.556696 457.77422 96.534407 517.986211 296.078452 500.389283 351.262948 480.659549 413.206407 432.615564 390.403835 432.615564 390.403835L432.615564 390.403835ZM382.455761 452.819661C433.75858 491.226456 397.780387 531.068453 397.780387 531.068453 375.031296 561.139591 247.811817 604.187117 230.966319 686.497876 221.254703 734.08081 163.70446 764.484948 128.836329 743.135665 49.781155 694.747359 19.911959 569.511419 73.914927 496.183166 133.171153 415.692739 336.732951 418.599317 382.455761 452.819661L382.455761 452.819661ZM440.126231 599.31871C491.582324 561.103416 517.389126 608.531018 517.389126 608.531018 538.228922 640.000121 538.824937 777.479424 609.893702 819.334316 651.00814 843.539107 661.401972 909.073226 630.834595 936.515468 561.559133 998.722769 436.251136 989.160439 384.981318 913.801197 328.676305 831.104242 394.282077 633.34649 440.126231 599.31871L440.126231 599.31871Z",
        "niagara": "M149.577143 397.604571c81.554286 0.365714 148.041143-62.610286 148.48-140.8a138.752 138.752 0 0 0-43.812572-99.913142 151.04 151.04 0 0 0-104.594285-40.96 151.04 151.04 0 0 0-104.813715 40.96 138.752 138.752 0 0 0-43.885714 99.913142C1.462857 334.994286 68.022857 398.043429 149.650286 397.604571z m0-234.788571c54.637714 0 98.889143 42.057143 98.889143 93.988571 0 51.785143-44.251429 93.842286-98.889143 93.842286-26.112 0.146286-51.2-9.654857-69.778286-27.282286a92.525714 92.525714 0 0 1-29.257143-66.56c0-51.931429 44.397714-93.988571 99.035429-93.988571z",
        "hart": "M810.666667 213.333333h-170.666667V128H128v384h48.213333l32 256H170.666667v128h256v-128H378.88l-21.333333-170.666667H469.333333v-85.333333h170.666667v-85.333333h170.666667V341.333333h128V298.666667h-128zM384 853.333333H213.333333v-42.666666h170.666667z m-133.12-85.333333l-32-256h85.333333l32 256zM426.666667 554.666667H352l-5.12-42.666667H426.666667z m170.666666-85.333334H170.666667V170.666667h426.666666v298.666666z m170.666667-85.333333h-128V256h128z",
        "pcworx": "M511.38 866.837c51.264 0 92.858-27.719 92.858-61.905 0-0.483-185.717 0.15-185.717 0 0 34.186 41.59 61.905 92.859 61.905z m289.458-246.655l130.584 113.321c12.605 11.699 16.686 29.835 10.338 45.735-6.287 15.899-21.826 26.358-39.056 26.358H667.472c-13.3 68.948-72.907 123.146-156.092 123.146-83.186 0-142.222-54.198-155.523-123.146H120.056c-17.23 0-32.769-10.459-39.056-26.358-6.349-15.9-2.268-34.036 10.338-45.735L222.89 620.182v-193.76c0-116.949 75.386-214.857 184.749-242.183 6.5-51.356 50.175-91.226 103.741-91.226 53.561 0 97.241 39.87 103.741 91.226 109.363 27.326 185.717 125.234 185.717 242.183v193.76z",
        "melsec": "M312.838 470.637c-15.109-15.442-39.893-15.745-55.248-0.632-15.472 15.109-15.775 39.863-0.632 55.308L419.104 691.21c7.255 7.435 17.229 11.664 27.625 11.758h0.303a39.133 39.133 0 0 0 27.503-11.275l309.217-305.437c15.322-15.172 15.502-39.926 0.3-55.311-15.079-15.262-39.833-15.535-55.278-0.3L447.545 608.426 312.838 470.637zM864.083 198.81c12.727 4.379 21.249 16.351 21.249 29.799v363.074c-9.671 215.281-348.597 346.361-362.984 351.832a31.558 31.558 0 0 1-11.182 2.054c-3.807 0-7.618-0.692-11.182-2.054C485.567 938.044 146.611 806.964 137 593.074V228.609c0-13.448 8.523-25.419 21.216-29.799L500.889 80.696a31.81 31.81 0 0 1 20.521 0L864.083 198.81z",
        "codesys": "M607.259 183.586l62.472-25.42c32.252-13.14 69.028 2.37 82.141 34.622a45.897 45.897 0 0 1 1.478 4.032l186.37 565.516c10.369 31.481-5.416 65.611-36.101 78.103l-62.505 25.422c-32.219 13.139-68.994-2.37-82.103-34.621a48.663 48.663 0 0 1-1.479-4.032L571.16 261.692c-10.402-31.482 5.418-65.612 36.099-78.106zM393.654 153.95h63.026c34.804 0 63.027 28.221 63.027 63.027V806.22c0 34.807-28.224 63.025-63.027 63.025h-63.026c-34.807 0-63.025-28.219-63.025-63.025V216.977c-0.001-34.806 28.218-63.027 63.025-63.027z m-252.105 0h63.025c34.804 0 63.026 28.221 63.026 63.027V806.22c0 34.807-28.222 63.025-63.026 63.025h-63.025c-34.807 0-63.031-28.219-63.031-63.025V216.977c0-34.806 28.224-63.027 63.031-63.027z"
      },
      devices: ["s7", "omron", "modbus", "bacnet", "ethip", "dnp3", "niagara", "hart", "pcworx", "melsec", "redlion", "codesys", "iec104"]
    };
  },
  mounted() {
    let devices = this.devices.map(device => {
      return getDeviceInfo(device);
    })
    Promise.all(devices).then(responses => {
      responses.forEach(response => {
        this.chartData[response.name] = this.processData(response.result)
      })
      this.initChart();
    }) 
    
  },
  beforeDestroy() {
    if (!this.chart) {
      return;
    }
    this.chart.dispose();
    this.chart = null;
  },
  watch: {
    chartData: {
      deep: true,
      handler(val) {
        console.log('sitmap watch!')
        this.setOptions(val);
      }
    }
  },
  methods: {
    changeCurrentDevice({ value }) {
      getSystemInfoByIp(value[2]).then(({ result }) => {
        this.$store.commit('UPDATE_DEVICES_INFO', result)
      })
      
    },
    processData(deviceInfos) {
      // 处理一下每个设备信息来用于echarts
      return deviceInfos.map(info => {
        return {
          name: info.location.country_name,
          value: [info.location.longitude, info.location.latitude, info.ip, info.data]
        }
      })
    },
    initChart() {
      this.chart = echarts.init(document.querySelector(".chart"));
      this.chart.on('click', this.changeCurrentDevice)
      this.setOptions(this.chartData);
    },
    setOptions(value) {
      const legends = [
        {
          name: "Siemens S7",
          icon: 'path://' + this.icon['s7'],
          dataName: 's7',
        },
        {
          name: "Modbus/TCP",
          icon: 'path://' + this.icon['modbus'],
          dataName: 'modbus'
        },
        {
          name: "ethernetIP",
          icon: 'path://' + this.icon['ethip'],
          dataName: 'ethip'
        },
        {
          name: "Omron-UDP",
          icon: 'path://' + this.icon['omron'],
          dataName: 'omron'
        },
        {
          name: "IEC104",
          icon: 'path://' + this.icon['iec104'],
          dataName: 'iec104',
        },
        {
          name: "BACnet",
          icon: 'path://' + this.icon['bacnet'],
          dataName: 'bacnet'
        },
        {
          name: "SNMP",
          icon: 'path://' + this.icon['snmp'],
          dataName: 'snmp'
        },
        {
          name: "Red Lion",  // 上位组态软件包括G303 g306
          icon: 'path://' + this.icon['redlion'],
          dataName: 'redlion'   // 在mongodb中collection的名字
        },
        // {
        //   name: "ClearSCADA",
        //   icon: 'path://' + this.icon['clearscada'],
        //   dataName: 'clearscada'
        // },
        {
          name: "Mitsubishi",
          icon: 'path://' + this.icon['melsec'],
          dataName: 'melsec'
        },
        {
          name: "ProConOS",
          icon: 'path://' + this.icon['proconos'],
          dataName: 'proconos'
        },
        {
          name: "CoDeSys",
          icon: 'path://' + this.icon['codesys'],
          dataName: 'codesys'
        },
        {
          name: "DNP3",
          icon: 'path://' + this.icon['dnp3'],
          dataName: 'dnp3'
        },
        {
          name: "Hart-IP",
          icon: 'path://' + this.icon['hart'],
          dataName: 'hart'
        },
        {
          name: "Niagara",
          icon: 'path://' + this.icon['niagara'],
          dataName: 'niagara'
        },
        {
          name: "PCWorx",
          icon: 'path://' + this.icon['pcworx'],
          dataName: 'pcworx'
        },
      ]
      
      let ss = [] // 批量生成相关series
      this.devices.forEach(device => {
        let legend = _.find(legends, (item) => item.dataName == device);
        ss.push(
          // {
            // name: legend.name,
            // type: "effectScatter",
            // coordinateSystem: "geo",
            // zlevel: 2,
            // // rippleEffect: {
            // //   //涟漪特效
            // //   period: 8, //动画时间，值越小速度越快
            // //   brushType: "stroke", //波纹绘制方式 stroke, fill
            // //   scale: 9 //波纹圆环最大限制，值越大波纹越大
            // // },
            // symbolSize: 3,
            // itemStyle: {
            //   normal: {
            //     show: false
            //   }
            // },
            // data: value[device]
          // },
          {
            name: legend.name,
            type: "scatter",
            coordinateSystem: "geo",
            data: value[device],
            symbolSize: 8,
            label: {
              normal: {
                show: false
              },
              emphasis: {
                show: false
              }
            },
            itemStyle: {
              emphasis: {
                borderColor: "#fff",
                borderWidth: 1
              },
            }
          }
          )
      })
      this.chart.setOption({
        backgroundColor: "#000",
        tooltip: {
          trigger: "item",
          formatter: function(params) {
            return params.seriesName + ", " + params.name + ", IP:" + params.value[2];
          }
        },
        legend: {
          orient: "vertical",
          y: "center",
          x: "right",
          backgroundColor: 'rgba(128, 128, 128, 0.2)',
          borderRadius: 5,
          data: legends,
          itemGap: 20,
          textStyle: {
            color: "#fff"
          }
        },
        geo: {
          roam: true,
          map: "world",
          label: {
            emphasis: {
              show: false
            }
          },
          zoom: 2,
          center: [115.97, 29.71],
          itemStyle: {
            normal: {
              areaColor: "#000", //#1b1b1b
              borderColor: "#409eff"
            },
            emphasis: {
              areaColor: "#2f21c4"
            }
          }
        },
        series: ss
      });
    },
    
  }
};
</script>
