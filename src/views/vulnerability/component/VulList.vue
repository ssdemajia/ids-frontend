<template>
  <div class="container">
    
    <el-row class="uploadRow">
      <el-col :span="4">
        <label class="labelUpload">更新漏洞库</label>
      </el-col>
      <el-col :span="8">
        <el-upload
          action="http://127.0.0.1:5000/vul/upload">
          <el-button size="small" type="primary">点击上传</el-button>
          <div slot="tip" class="el-upload__tip">只能上传漏洞库文件，且不超过500kb</div>
        </el-upload>
      </el-col>
      <el-col :span="4">
        <div class="vulCount">
          <label class="">漏洞总数:</label>
          <label class="">{{ vulCount }} </label>
        </div>
      </el-col>
    </el-row>
    <el-row>
      <el-table
        height="740"
        :data="handleVulInList"
        @row-click="handleClick">
        <el-table-column
        :show-overflow-tooltip="true"
        prop="title"
        label="简介"
        >
      </el-table-column>
      <el-table-column
        prop="date"
        label="时间"
        width="180">
      </el-table-column>
      <el-table-column
        prop="level"
        width="80"
        label="危险级别">
        <template slot-scope="scope">
          <el-tag :type="computeLevel(scope.row.level)">{{ scope.row.level }}</el-tag>
        </template>
      </el-table-column>
      </el-table>
    </el-row>
    <el-row>
      <el-pagination
        :page-size="pageSize"
        :total="vulCount"
        @current-change="handleCurrentChange">

      </el-pagination>
    </el-row>
  </div>
</template>

<script>
export default {
  props:{
    vul: {
      type: Array
    },
    vulCount: {
      type: Number
    },
    pageSize: {
      type: Number
    }

  },
  data() {
    return {
      levelToType: {
        高: 'danger',
        中: 'warning',
        低: 'info'
      }
    }
  },
  methods: {
    handleCurrentChange(index) {
      // 更改详情页
      this.$emit('changeIndex', index)
    },
    computeLevel(level) {
      level = level[0]  // 竟然是长度为4
      return this.levelToType[level]
    },
    handleClick(row, event, column) {
      this.$emit('clickRow', row)
    }
  },
  computed: {
    handleVulInList() { // 对列表中展示的漏洞等级进行处理
      for (let i = 0; i < this.vul.length; i++) {
        let temp = this.vul[i].level.replace(/\n|\t/g, '')
        temp = temp.split('(')[0]
        this.vul[i].level = temp
      }
      return this.vul
    },
  }
}
</script>
<style scoped>
.container {
  font-family: "Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif;
  background-color: white;
  box-shadow: 0 0 4px rgba(0, 0, 0, .1);
}
.container .labelUpload {
  display: inline-block;
  color: #606266;
  margin-top: 15%;
}
.container .vulCount {
  color: #606266;
  width: 100%;
  margin-left: 10%;
  margin-top: 15%;
}

</style>
