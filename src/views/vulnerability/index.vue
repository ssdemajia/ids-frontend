<template>
  <div class="container">
    <el-row :gutter="20">
      <el-col :span="12">
        <vul-list class="vulList"
          :vul="vuls"
          :pageSize="itemPerPage"
          :vulCount="itemCount"
          @changeIndex="handleIndex"
          @clickRow="handleClick"
        >
        </vul-list>
      </el-col>
      <el-col :span="12">
        <vul-detail :vul="currentVul"></vul-detail>
      </el-col>
    </el-row>
   
  </div>
</template>

<script>
import VulDetail from "./component/VulDetail"
import VulList from "./component/VulList"
import { getVulList } from "@/api/vulnerability"
export default {
  data() {
    return {
      vuls: [],
      itemPerPage: 13,
      currentPage: 1,
      itemCount: 0,
      currentVul: {},
    }
  },
  methods: {
    getRange() {
      var start = (this.currentPage - 1) * this.itemPerPage
      var end = this.currentPage * this.itemPerPage
      return { start, end }
    },
    handleIndex(index) {
      this.currentPage = index
      var {start, end} = this.getRange()
      getVulList(start, end).then((response) => {
        this.itemCount = response.count
        this.vuls = response.result
      
      })
    },
    handleClick(row) {
      console.log(row)
      this.currentVul = row
    }
  },
  mounted() {
    var {start, end} = this.getRange()
    getVulList(start, end).then((response) => {
      this.itemCount = response.count
      this.vuls = response.result
      if (this.vuls.length > 0) {
        this.currentVul = this.vuls[0]
      }
      
      // console.log(response)
    })
  },
  components: {
    VulDetail,
    VulList
  }
}
</script>

<style scoped>
.container {
  padding: 20px;
  background-color: #f0f2f5;
}

</style>

